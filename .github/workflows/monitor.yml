name: ç›‘æ§ Î± å¤´ç›®åˆ·æ–°

on:
  schedule:
    - cron: '*/5 * * * *'   # æ¯5åˆ†é’Ÿä¸€æ¬¡
  workflow_dispatch:           # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      # ã€1ã€‘ä¸‹è½½ä¸Šä¸€æ¬¡çš„çŠ¶æ€
      - name: ä¸‹è½½ä¸Šæ¬¡çŠ¶æ€
        id: cache-download
        uses: actions/cache@v3
        with:
          path: last_three_sum.json
          key: data-last-three-sum
          restore-keys: |
            data-last-three-sum

      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: å®‰è£…ä¾èµ–åº“
        run: |
          pip install selenium webdriver-manager requests

      - name: è¿è¡Œæ£€æµ‹è„šæœ¬
        env:
          SENDKEY: ${{ secrets.SENDKEY }}
        run: python detect.py

      # ã€2ã€‘è°ƒè¯•ï¼šæŸ¥çœ‹æ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
      - name: Debug - æŸ¥çœ‹çŠ¶æ€æ–‡ä»¶
        run: |
          echo "ğŸ“ å½“å‰ç›®å½•:"
          ls -la
          echo ""
          echo "ğŸ“„ å°è¯•è¯»å– last_three_sum.json å†…å®¹:"
          cat last_three_sum.json || echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©º"

      # ã€3ã€‘ä¸Šä¼ æœ¬æ¬¡çŠ¶æ€ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰
      - name: ä¸Šä¼ æœ¬æ¬¡çŠ¶æ€
        if: always()  # å³ä½¿å‰é¢å¤±è´¥ä¹Ÿå°è¯•ä¸Šä¼ 
        uses: actions/cache@v3
        with:
          path: last_three_sum.json
          key: data-last-three-sum
