# detect.py - ä»…å½“ç¬¬ä¸€ä¸ªå›¾ç‰‡å˜åŒ–ä¸”ä¸æ˜¯ alpha.png æ—¶æé†’
import os
import time
import json
import re
from datetime import datetime
import requests
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager

# === æ’å…¥å›¾é‰´ï¼ˆPOKEMON_ZH å­—å…¸ï¼‰===
# #æ’å…¥å›¾é‰´
POKEMON_ZH = {
    # ç¬¬ä¸€ä¸–ä»£ (1-151)
    1: "å¦™è›™ç§å­", 2: "å¦™è›™è‰", 3: "å¦™è›™èŠ±",
    4: "å°ç«é¾™", 5: "ç«æé¾™", 6: "å–·ç«é¾™",
    7: "æ°å°¼é¾Ÿ", 8: "å¡å’ªé¾Ÿ", 9: "æ°´ç®­é¾Ÿ",
    10: "ç»¿æ¯›è™«", 11: "é“ç”²è›¹", 12: "å·´å¤§è¶",
    13: "ç‹¬è§’è™«", 14: "é“å£³è›¹", 15: "å¤§é’ˆèœ‚",
    16: "æ³¢æ³¢", 17: "æ¯”æ¯”é¸Ÿ", 18: "å¤§æ¯”é¸Ÿ",
    19: "å°æ‹‰è¾¾", 20: "æ‹‰è¾¾",
    21: "çƒˆé›€", 22: "å¤§å˜´é›€",
    23: "é˜¿æŸè›‡", 24: "é˜¿æŸæ€ª",
    25: "çš®å¡ä¸˜", 26: "é›·ä¸˜",
    27: "ç©¿å±±é¼ ", 28: "ç©¿å±±ç‹",
    29: "å°¼å¤šå…°", 30: "å°¼å¤šå¨œ", 31: "å°¼å¤šå", 32: "å°¼å¤šåŠ›è¯º", 33: "å°¼å¤šæœ—", 34: "å°¼å¤šç‹",
    35: "çš®çš®", 36: "çš®å¯è¥¿",
    37: "å…­å°¾", 38: "ä¹å°¾",
    39: "èƒ–ä¸", 40: "èƒ–å¯ä¸",
    41: "è¶…éŸ³è ", 42: "å¤§å˜´è ",
    43: "èµ°è·¯è‰", 44: "è‡­è‡­èŠ±", 45: "éœ¸ç‹èŠ±",
    46: "æ´¾æ‹‰æ–¯", 47: "æ´¾æ‹‰æ–¯ç‰¹",
    48: "æ¯›çƒ", 49: "æœ«å…¥è›¾",
    50: "åœ°é¼ ", 51: "ä¸‰åœ°é¼ ",
    52: "å–µå–µ", 53: "çŒ«è€å¤§",
    54: "å¯è¾¾é¸­", 55: "å“¥è¾¾é¸­",
    56: "çŒ´æ€ª", 57: "ç«çˆ†çŒ´",
    58: "å¡è’‚ç‹—", 59: "é£é€Ÿç‹—",
    60: "èšŠé¦™èŒèšª", 61: "èšŠé¦™è›™", 62: "å¿«æ³³è›™",
    63: "å‡¯è¥¿", 64: "å‹‡åŸºæ‹‰", 65: "èƒ¡åœ°",
    66: "è…•åŠ›", 67: "è±ªåŠ›", 68: "æ€ªåŠ›",
    69: "å–‡å­èŠ½", 70: "å£å‘†èŠ±",71: "å¤§é£ŸèŠ±",
    72: "ç›ç‘™æ°´æ¯", 73: "æ¯’åˆºæ°´æ¯",
    74: "å°æ‹³çŸ³", 75: "éš†éš†çŸ³", 76: "éš†éš†å²©",
    77: "å°ç«é©¬", 78: "çƒˆç„°é©¬",
    79: "å‘†å‘†å…½", 80: "å‘†æ²³é©¬",
    81: "å°ç£æ€ª", 82: "ä¸‰åˆä¸€ç£æ€ª",
    83: "å¤§è‘±é¸­", 84: "å˜Ÿå˜Ÿ", 85: "å˜Ÿå˜Ÿåˆ©",
    86: "å°æµ·ç‹®", 87: "ç™½æµ·ç‹®",
    88: "è‡­æ³¥", 89: "è‡­è‡­æ³¥",
    90: "å¤§èˆŒè´", 91: "åˆºç”²è´",
    92: "é¬¼æ–¯", 93: "é¬¼æ–¯é€š", 94: "è€¿é¬¼",
    95: "å¤§å²©è›‡",
    96: "å‚¬çœ è²˜", 97: "å¼•æ¢¦è²˜äºº",
    98: "å¤§é’³èŸ¹", 99: "å·¨é’³èŸ¹",
    100: "éœ¹é›³ç”µçƒ", 101: "é¡½çš®é›·å¼¹",
    102: "è›‹è›‹", 103: "æ¤°è›‹æ ‘",
    104: "å¡æ‹‰å¡æ‹‰", 105: "å˜å•¦å˜å•¦",
    106: "é£è…¿éƒ", 107: "å¿«æ‹³éƒ",
    108: "å¤§èˆŒå¤´",
    109: "ç“¦æ–¯å¼¹", 110: "åŒå¼¹ç“¦æ–¯",
    111: "ç‹¬è§’çŠ€ç‰›", 112: "é’»è§’çŠ€å…½",
    113: "å‰åˆ©è›‹",
    114: "è”“è—¤æ€ª",
    115: "è¢‹å…½",
    116: "å¢¨æµ·é©¬", 117: "æµ·åˆºé¾™",
    118: "è§’é‡‘é±¼", 119: "é‡‘é±¼ç‹", 
    120: "æµ·æ˜Ÿæ˜Ÿ",121: "å®çŸ³æµ·æ˜Ÿ",
    122: "é­”å¢™äººå¶",
    123: "é£å¤©è³è‚",
    124: "è¿·å”‡å§",
    125: "ç”µå‡»å…½",
    126: "é¸­å˜´ç«å…½",
    127: "å‡¯ç½—æ–¯",
    128: "è‚¯æ³°ç½—",
    129: "é²¤é±¼ç‹", 130: "æš´é²¤é¾™",
    131: "ä¹˜é¾™",
    132: "ç™¾å˜æ€ª",
    133: "ä¼Šå¸ƒ", 134: "æ°´ä¼Šå¸ƒ", 135: "é›·ä¼Šå¸ƒ", 136: "ç«ä¼Šå¸ƒ",
    137: "å¤šè¾¹å…½",
    138: "èŠçŸ³å…½", 139: "å¤šåˆºèŠçŸ³å…½",
    140: "åŒ–çŸ³ç›”", 141: "é•°åˆ€ç›”",
    142: "åŒ–çŸ³ç¿¼é¾™",
    143: "å¡æ¯”å…½",
    144: "æ€¥å†»é¸Ÿ",
    145: "é—ªç”µé¸Ÿ",
    146: "ç«ç„°é¸Ÿ",
    147: "è¿·ä½ é¾™", 148: "å“ˆå…‹é¾™", 149: "å¿«é¾™",
    150: "è¶…æ¢¦", 151: "æ¢¦å¹»",

    # ç¬¬äºŒä¸–ä»£ (152-251)
    152: "èŠè‰å¶", 153: "æœˆæ¡‚å¶", 154: "å¤§èŠèŠ±",
    155: "ç«çƒé¼ ", 156: "ç«å²©é¼ ", 157: "ç«æš´å…½",
    158: "å°é”¯é³„", 159: "è“é³„", 160: "å¤§åŠ›é³„",
    161: "å°¾ç«‹", 162: "å¤§å°¾ç«‹",
    163: "å’•å’•", 164: "çŒ«å¤´å¤œé¹°",
    165: "èŠ­ç“¢è™«", 166: "å®‰ç“¢è™«",
    167: "å›­ä¸è››", 168: "é˜¿åˆ©å¤šæ–¯",
    169: "å‰å­—è ",
    170: "ç¯ç¬¼é±¼", 171: "ç”µç¯æ€ª",
    172: "çš®ä¸˜",
    173: "çš®å®å®",
    174: "å®å®ä¸",
    175: "æ³¢å…‹æ¯”", 176: "æ³¢å…‹åŸºå¤",
    177: "å¤©ç„¶é›€", 178: "å¤©ç„¶é¸Ÿ",
    179: "å’©åˆ©ç¾Š", 180: "èŒ¸èŒ¸ç¾Š", 181: "ç”µé¾™",
    182: "ç¾ä¸½èŠ±",
    183: "ç›åŠ›éœ²", 184: "ç›åŠ›éœ²ä¸½",
    185: "æ ‘æ‰æ€ª",
    186: "èšŠé¦™è›™çš‡",
    187: "æ¯½å­è‰", 188: "æ¯½å­èŠ±", 189: "æ¯½å­æ£‰",
    190: "é•¿å°¾æ€ªæ‰‹",
    191: "å‘æ—¥ç§å­", 192: "å‘æ—¥èŠ±æ€ª",
    193: "èœ»èœ»èœ“", 
    194: "ä¹Œæ³¢", 195: "æ²¼ç‹",
    196: "å¤ªé˜³ä¼Šå¸ƒ", 197: "æœˆäº®ä¼Šå¸ƒ",
    198: "é»‘æš—é¸¦",
    199: "å‘†å‘†ç‹",
    200: "æ¢¦å¦–",
    201: "æœªçŸ¥å›¾è…¾",
    202: "æœç„¶ç¿",
    203: "éº’éºŸå¥‡",
    204: "æ¦›æœçƒ",205: "ä½›çƒˆæ‰˜æ–¯",
    206: "åœŸé¾™å¼Ÿå¼Ÿ",
    207: "å¤©è",
    208: "å¤§é’¢è›‡",
    209: "å¸ƒé²", 210: "å¸ƒé²çš‡", 
    211: "åƒé’ˆé±¼",
    212: "å·¨é’³è³è‚", 
    213: "å£¶å£¶",
    214: "èµ«æ‹‰å…‹ç½—æ–¯",
    215: "ç‹ƒæ‹‰", 
    216: "ç†Šå®å®",217: "åœˆåœˆç†Š", 
    218: "ç†”å²©è™«", 219: "ç†”å²©èœ—ç‰›",
    220: "å°å±±çŒª", 221: "é•¿æ¯›çŒª",
    222: "å¤ªé˜³çŠç‘š",
    223: "é“ç‚®é±¼", 224: "ç« é±¼æ¡¶",
    225: "ä¿¡ä½¿é¸Ÿ",
    226: "å·¨ç¿…é£é±¼",
    227: "ç›”ç”²é¸Ÿ",
    228: "æˆ´é²æ¯”",229: "é»‘é²åŠ ",
    230: "åˆºé¾™ç‹",
    231: "å°å°è±¡", 232: "é¡¿ç”²",
    233: "å¤šè¾¹å…½â…¡",
    234: "æƒŠè§’é¹¿",
    235: "å›¾å›¾çŠ¬",
    236: "æ— ç•å°å­", 237: "æˆ˜èˆéƒ",
    238: "è¿·å”‡å¨ƒ",
    239: "ç”µå‡»æ€ª", 240: "é¸­å˜´å®å®",
    241: "å¤§å¥¶ç½",
    242: "å¹¸ç¦è›‹",
    243: "é›·å…¬",
    244: "ç‚å¸",
    245: "æ°´å›",
    246: "å¹¼åŸºæ‹‰æ–¯", 247: "æ²™åŸºæ‹‰æ–¯", 248: "ç­åŸºæ‹‰æ–¯",
    249: "æ´›å¥‡äºš",
    250: "å‡¤ç‹",
    251: "æ—¶æ‹‰æ¯”",

    # ç¬¬ä¸‰ä¸–ä»£ (252-386)
    252: "æœ¨å®ˆå®«", 253: "æ£®æ—èœ¥èœ´", 254: "èœ¥èœ´ç‹",
    255: "ç«ç¨šé¸¡", 256: "åŠ›å£®é¸¡", 257: "ç«ç„°é¸¡",
    258: "æ°´è·ƒé±¼", 259: "æ²¼è·ƒé±¼", 260: "å·¨æ²¼æ€ª",
    261: "åœŸç‹¼çŠ¬", 262: "å¤§ç‹¼çŠ¬",
    263: "è›‡çº¹ç†Š", 264: "ç›´å†²ç†Š",
    265: "åˆºå°¾è™«", 266: "ç”²å£³èŒ§", 267: "ç‹©çŒå‡¤è¶",
    268: "ç›¾ç”²èŒ§", 269: "æ¯’ç²‰è›¾",
    270: "è²å¶ç«¥å­", 271: "è²å¸½å°ç«¥", 272: "ä¹å¤©æ²³ç«¥",
    273: "æ©¡å®æœ", 274: "é•¿é¼»å¶", 275: "ç‹¡çŒ¾å¤©ç‹—",
    276: "å‚²éª¨ç‡•", 277: "å¤§ç‹ç‡•",
    278: "é•¿ç¿…é¸¥", 279: "å¤§å˜´é¸¥",
    280: "æ‹‰é²æ‹‰ä¸", 281: "å¥‡é²è‰å®‰", 282: "æ²™å¥ˆæœµ",
    283: "æºœæºœç³–çƒ", 284: "é›¨ç¿…è›¾",
    285: "è˜‘è˜‘è‡", 286: "æ–—ç¬ è‡",
    287: "æ‡’äººç¿", 288: "è¿‡åŠ¨çŒ¿", 289: "è¯·å‡ç‹",
    290: "åœŸå±…å¿å£«", 291: "é“é¢å¿è€…",292: "è„±å£³å¿è€…",
    293: "å’•å¦å¦",294: "å¼çˆ†å¼¹",295: "çˆ†éŸ³æ€ª", 
    296: "å¹•ä¸‹åŠ›å£«",297: "é“æŒåŠ›å£«", 
    298: "éœ²åŠ›ä¸½",
    299: "æœåŒ—é¼»", 
    300: "å‘å°¾å–µ", 301: "ä¼˜é›…çŒ«",
    302: "å‹¾é­‚çœ¼", 
    303: "å¤§å˜´å¨ƒ",
    304: "å¯å¯å¤šæ‹‰", 305: "å¯å¤šæ‹‰", 306: "æ³¢å£«å¯å¤šæ‹‰",
    307: "ç›æ²™é‚£", 308: "æ°é›·å§†", 
    309: "è½é›·å…½",310: "é›·ç”µå…½",
    311: "æ­£ç”µæ‹æ‹",312: "è´Ÿç”µæ‹æ‹", 
    313: "ç”µè¤è™«",314: "ç”œç”œè¤", 
    315: "æ¯’è”·è–‡", 
    316: "æº¶é£Ÿå…½",317: "åé£Ÿå…½", 
    318: "åˆ©ç‰™é±¼",319: "å·¨ç‰™é²¨", 
    320: "å¼å¼é²¸", 321: "å¼é²¸ç‹",
    322: "å‘†ç«é©¼", 323: "å–·ç«é©¼",
    324: "ç…¤ç‚­é¾Ÿ",
    325: "è·³è·³çŒª", 326: "å™—å™—çŒª",
    327: "æ™ƒæ™ƒæ–‘",
    328: "å¤§é¢šèš", 329: "è¶…éŸ³æ³¢å¹¼è™«", 330: "æ²™æ¼ èœ»èœ“",
    331: "åˆºçƒä»™äººæŒ", 332: "æ¢¦æ­Œä»™äººæŒ", 
    333: "é’æ£‰é¸Ÿ",334: "ä¸ƒå¤•é’é¸Ÿ", 
    335: "çŒ«é¼¬æ–©",
    336: "é¥­åŒ™è›‡",
    337: "æœˆçŸ³", 338: "å¤ªé˜³å²©",
    339: "æ³¥æ³¥é³…", 340: "é²¶é±¼ç‹",
    341: "é¾™è™¾å°å…µ", 342: "é“é³Œé¾™è™¾",
    343: "å¤©å¹³å¶", 344: "å¿µåŠ›åœŸå¶",
    345: "è§¦æ‰‹ç™¾åˆ",346: "æ‘‡ç¯®ç™¾åˆ", 
    347: "å¤ªå¤ç¾½è™«",348: "å¤ªå¤ç›”ç”²",
    349: "ä¸‘ä¸‘é±¼",350: "ç¾çº³æ–¯", 
    351: "æ¼‚æµ®æ³¡æ³¡",
    352: "å˜éšé¾™",
    353: "æ€¨å½±å¨ƒå¨ƒ", 354: "è¯…å’’å¨ƒå¨ƒ", 
    355: "å¤œå·¡çµ",356: "å½·å¾¨å¤œçµ", 
    357: "çƒ­å¸¦é¾™",
    358: "é£é“ƒé“ƒ",
    359: "é˜¿ä¼¯æ¢­é²",
    360: "å°æœç„¶", 
    361: "é›ªç«¥å­",362: "å†°é¬¼æŠ¤", 
    363: "æµ·è±¹çƒ",364: "æµ·é­”ç‹®", 365: "å¸ç‰™æµ·ç‹®",
    366: "çç è´",367: "çŒæ–‘é±¼", 368: "æ¨±èŠ±é±¼", 
    369: "å¤ç©ºæ£˜é±¼",
    370: "çˆ±å¿ƒé±¼",
    371: "å®è´é¾™",372: "ç”²å£³é¾™",373: "æš´é£é¾™", 
    374: "é“å“‘é“ƒ",375: "é‡‘å±æ€ª", 376: "å·¨é‡‘æ€ª",
    377: "é›·å‰æ´›å…‹", 
    378: "é›·å‰è‰¾æ–¯",
    379: "é›·å‰æ–¯é½é²", 
    380: "æ‹‰å¸äºšæ–¯", 
    381: "æ‹‰å¸æ¬§æ–¯",
    382: "ç›–æ¬§å¡",
    383: "å›ºæ‹‰å¤š",
    384: "è£‚ç©ºåº§",
    385: "åŸºæ‹‰ç¥ˆ",
    386: "ä»£æ¬§å¥‡å¸Œæ–¯",

    # ç¬¬å››ä¸–ä»£ (387-493)
    387: "è‰è‹—é¾Ÿ", 388: "æ ‘æ—é¾Ÿ", 389: "åœŸå°é¾Ÿ",
    390: "å°ç«ç„°çŒ´", 391: "çŒ›ç«çŒ´", 392: "çƒˆç„°çŒ´",
    393: "æ³¢åŠ æ›¼", 394: "æ³¢çš‡å­", 395: "å¸ç‹æ‹¿æ³¢",
    396: "å§†å…‹å„¿", 397: "å§†å…‹é¸Ÿ", 398: "å§†å…‹é¹°",
    399: "åœ†æ³•å¸ˆ", 400: "é­”å°¼å°¼",
    401: "å°çŒ«æ€ª", 402: "å‹’å…‹çŒ«", 403: "ä¼¦ç´çŒ«",
    404: "å«ç¾è‹", 405: "ç½—ä¸é›·æœµ",
    406: "å¤´ç›–é¾™", 407: "æˆ˜æ§Œé¾™",
    408: "ç›¾ç”²é¾™", 409: "æŠ¤åŸé¾™",
    410: "ç»“è‰å„¿", 411: "ç»“è‰è´µå¦‡", 412: "ç»…å£«è›¾",
    413: "ä¸‰èœœèœ‚", 414: "èœœå¥³ç‹",
    415: "èŠ½å¹é¹¿", 416: "ä¸°èœœé¾™",
    417: "å¸•è·¯å¥‡çŠ½",
    418: "ç»“è‰å„¿", 419: "ç»“è‰è´µå¦‡", 420: "ç»…å£«è›¾",
    421: "ä¸‰èœœèœ‚", 422: "èœœå¥³ç‹", 423: "èŠ½å¹é¹¿", 424: "ä¸°èœœé¾™",
    425: "é£˜æµ®æ³¡æ³¡", 426: "çç è´",
    427: "éœ“è™¹é±¼", 428: "æ¨±èŠ±é±¼",
    429: "ä¹Œè´¼ç‹",
    430: "é“œé•œæ€ª",
    431: "èµ¤é¢é¾™",
    432: "å®å®ä¸",
    433: "å·å·è€³", 434: "é•¿è€³å…”",
    435: "æ¢¦å¦–", 436: "æ¢¦å¦–é­”",
    437: "å°ç¦è›‹", 438: "å‰åˆ©è›‹",
    439: "ç›èé‚£", 440: "é­”å°¼å°¼",
    441: "è…•åŠ›", 442: "è±ªåŠ›", 443: "æ€ªåŠ›",
    444: "ç…¤ç‚­é¾Ÿ",
    445: "è·³è·³çŒª", 446: "å™—å™—çŒª",
    447: "å¼çˆ†å¼¹", 448: "å‘å°¾å–µ", 449: "ä¼˜é›…çŒ«",
    450: "å‹¾é­‚çœ¼", 451: "å¤§ç‹¼çŠ¬",
    452: "å¤§é¢šèš", 453: "è¶…éŸ³æ³¢å¹¼è™«", 454: "æ²™æ¼ èœ»èœ“",
    455: "å®è´é¾™", 456: "ç”²å£³é¾™", 457: "æš´é£é¾™",
    458: "çˆ±å¿ƒé±¼", 459: "éœæ¬§çº³",
    460: "é˜¿å‹ƒæ¢­é²",
    461: "å°æœç„¶", 462: "æœç„¶ç¿",
    463: "å¤ªé˜³å²©", 464: "æœˆçŸ³",
    465: "æ³¥æ³¥é³…", 466: "é²¶é±¼ç‹",
    467: "åœ°ç‰¢", 468: "æ™ƒæ™ƒå®", 469: "æ™ƒæ™ƒæ–‘",
    470: "è§¦æ‰‹ç™¾åˆ", 471: "æ‘‡ç¯®ç™¾åˆ",
    472: "å¤ªå¤ç¾½è™«", 473: "å¤ªå¤ç›”ç”²",
    474: "ä¸‘ä¸‘é±¼", 475: "ç¾çº³æ–¯",
    476: "å‘†æœ¨", 477: "é’ç»µé¸Ÿ", 478: "å‘†ç«é©¼", 479: "å–·ç«é©¼",
    480: "ç…¤ç‚­é¾Ÿ",
    481: "è·³è·³çŒª", 482: "å™—å™—çŒª",
    483: "å¼çˆ†å¼¹", 484: "å‘å°¾å–µ", 485: "ä¼˜é›…çŒ«",
    486: "å‹¾é­‚çœ¼", 487: "å¤§ç‹¼çŠ¬",
    488: "å¤§é¢šèš", 489: "è¶…éŸ³æ³¢å¹¼è™«", 490: "æ²™æ¼ èœ»èœ“",
    491: "å®è´é¾™", 492: "ç”²å£³é¾™", 493: "æš´é£é¾™",

    # ç¬¬äº”ä¸–ä»£ (494-649)
    494: "è±å¸Œæ‹‰å§†",   495: "æ·å…‹ç½—å§†",   496: "é…‹é›·å§†",
    497: "å•é¦–é¾™",     498: "åŒé¦–æš´é¾™",   499: "ä¸‰é¦–æ¶é¾™",
    500: "åœŸåœ°äº‘",     501: "é…‹é›·å§†",     502: "ç‚½ç„°å’†å“®è™",
    503: "æš—é»‘é…‹é›·å§†", 504: "å…‰è¾‰é…‹é›·å§†", 505: "çˆ†é¦™çŒ´",
    506: "èŠ±æ¤°çŒ´",     507: "èŠ±æ¤°çŒ¿",     508: "æ»‘æ»‘å°å­",
    509: "å¤´å·¾æ··æ··",   510: "è½»é£˜é£˜",     511: "èƒ–ç”œå¦®",
    512: "ä¿å§†è™«",     513: "å‹‡å£«é›„é¹°",   514: "æ‘”è§’é¹°äºº",
    515: "é¢¤å¼¦è¾èˆ",   516: "éŸ³æ³¢é¾™",     517: "ç«ç¥è›¾",
    518: "é’©çˆªé›Œè™",   519: "çˆ†é¦™çŒ´",     520: "èŠ±æ¤°çŒ´",
    521: "èŠ±æ¤°çŒ¿",     522: "ç‡ƒçƒ§è™«",     523: "åƒåœ¾è¢‹",
    524: "å››é¢šé’ˆé¾™",   525: "å†°é›ªé¾™",     526: "æš´é›ªç‹",
    527: "æ–§ç‰™é¾™",     528: "åŒæ–§æˆ˜é¾™",   529: "åŠˆæ–§è³è‚",
    530: "æ»‘æ»‘å°å­",   531: "å¤´å·¾æ··æ··",   532: "è½»é£˜é£˜",
    533: "èƒ–ç”œå¦®",     534: "ä¿å§†è™«",     535: "å‹‡å£«é›„é¹°",
    536: "æ‘”è§’é¹°äºº",   537: "é¢¤å¼¦è¾èˆ",   538: "éŸ³æ³¢é¾™",
    539: "ç«ç¥è›¾",     540: "é’©çˆªé›Œè™",   541: "çˆ†é¦™çŒ´",
    542: "èŠ±æ¤°çŒ´",     543: "èŠ±æ¤°çŒ¿",     544: "ç‡ƒçƒ§è™«",
    545: "åƒåœ¾è¢‹",     546: "å››é¢šé’ˆé¾™",   547: "å†°é›ªé¾™",
    548: "æš´é›ªç‹",     549: "æ–§ç‰™é¾™",     550: "åŒæ–§æˆ˜é¾™",
    551: "åŠˆæ–§è³è‚",   552: "æ»‘æ»‘å°å­",   553: "å¤´å·¾æ··æ··",
    554: "å¼ºå£®èŸ¾èœ",   555: "è½»é£˜é£˜",     556: "èƒ–ç”œå¦®",
    557: "ä¿å§†è™«",     558: "å‹‡å£«é›„é¹°",   559: "æ‘”è§’é¹°äºº",
    560: "é¢¤å¼¦è¾èˆ",   561: "éŸ³æ³¢é¾™",     562: "ç«ç¥è›¾",
    563: "é’©çˆªé›Œè™",   564: "çˆ†é¦™çŒ´",     565: "èŠ±æ¤°çŒ´",
    566: "èŠ±æ¤°çŒ¿",     567: "ç‡ƒçƒ§è™«",     568: "åƒåœ¾è¢‹",
    569: "å››é¢šé’ˆé¾™",   570: "å†°é›ªé¾™",     571: "æš´é›ªç‹",
    572: "æ–§ç‰™é¾™",     573: "åŒæ–§æˆ˜é¾™",   574: "åŠˆæ–§è³è‚",
    575: "æ»‘æ»‘å°å­",   576: "å¤´å·¾æ··æ··",   577: "è½»é£˜é£˜",
    578: "èƒ–ç”œå¦®",     579: "ä¿å§†è™«",     580: "å‹‡å£«é›„é¹°",
    581: "æ‘”è§’é¹°äºº",   582: "é¢¤å¼¦è¾èˆ",   583: "éŸ³æ³¢é¾™",
    584: "ç«ç¥è›¾",     585: "é’©çˆªé›Œè™",   586: "çˆ†é¦™çŒ´",
    587: "èŠ±æ¤°çŒ´",     588: "èŠ±æ¤°çŒ¿",     589: "ç‡ƒçƒ§è™«",
    590: "åƒåœ¾è¢‹",     591: "å››é¢šé’ˆé¾™",   592: "å†°é›ªé¾™",
    593: "æš´é›ªç‹",     594: "æ–§ç‰™é¾™",     595: "åŒæ–§æˆ˜é¾™",
    596: "åŠˆæ–§è³è‚",   597: "æ»‘æ»‘å°å­",   598: "å¤´å·¾æ··æ··",
    599: "è½»é£˜é£˜",     600: "èƒ–ç”œå¦®",     601: "ä¿å§†è™«",
    602: "å‹‡å£«é›„é¹°",   603: "æ‘”è§’é¹°äºº",   604: "é¢¤å¼¦è¾èˆ",
    605: "éŸ³æ³¢é¾™",     606: "ç«ç¥è›¾",     607: "é’©çˆªé›Œè™",
    608: "çˆ†é¦™çŒ´",     609: "èŠ±æ¤°çŒ´",     610: "èŠ±æ¤°çŒ¿",
    611: "ç‡ƒçƒ§è™«",     612: "åƒåœ¾è¢‹",     613: "å››é¢šé’ˆé¾™",
    614: "å†°é›ªé¾™",     615: "æš´é›ªç‹",     616: "æ–§ç‰™é¾™",
    617: "åŒæ–§æˆ˜é¾™",   618: "åŠˆæ–§è³è‚",   619: "æ»‘æ»‘å°å­",
    620: "å¤´å·¾æ··æ··",   621: "å¼ºå£®èŸ¾èœ",   622: "è½»é£˜é£˜",
    623: "èƒ–ç”œå¦®",     624: "ä¿å§†è™«",     625: "å‹‡å£«é›„é¹°",
    626: "æ‘”è§’é¹°äºº",   627: "é¢¤å¼¦è¾èˆ",   628: "éŸ³æ³¢é¾™",
    629: "ç«ç¥è›¾",     630: "é’©çˆªé›Œè™",   631: "çˆ†é¦™çŒ´",
    632: "èŠ±æ¤°çŒ´",     633: "èŠ±æ¤°çŒ¿",     634: "ç‡ƒçƒ§è™«",
    635: "åƒåœ¾è¢‹",     636: "å››é¢šé’ˆé¾™",   637: "å†°é›ªé¾™",
    638: "æš´é›ªç‹",     639: "æ–§ç‰™é¾™",     640: "åŒæ–§æˆ˜é¾™",
    641: "åŠˆæ–§è³è‚",   642: "æ»‘æ»‘å°å­",   643: "å¤´å·¾æ··æ··",
    644: "è½»é£˜é£˜",     645: "èƒ–ç”œå¦®",     646: "ä¿å§†è™«",
    647: "å‹‡å£«é›„é¹°",   648: "æ‘”è§’é¹°äºº",   649: "é¢¤å¼¦è¾èˆ"
}

# === é…ç½® ===
URL = "https://pokemmo.lanbizi.com/damage"
SENDKEY = os.getenv("SENDKEY")
DATA_FILE = "last_three_sum.json"  # çŠ¶æ€æ–‡ä»¶


def get_driver():
    options = Options()
    options.add_argument('--headless')
    options.add_argument('--no-sandbox')
    options.add_argument('--disable-dev-shm-usage')
    service = Service(ChromeDriverManager().install())
    return webdriver.Chrome(service=service, options=options)


def send_alert(pokemon_name):
    title = "ğŸ”¥ æœ‰æ–°çš„å¤´ç›®å‡ºç°äº†"
    content = f"æœ€æ–°å¤´ç›®ï¼š**{pokemon_name}**\n\nè¯·ç«‹å³å‰å¾€æŸ¥çœ‹ >>\nğŸ”— [ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…]({URL})"
    try:
        requests.post(
            f"https://sctapi.ftqq.com/{SENDKEY}.send",
            data={"title": title, "desp": content},
            timeout=10
        )
        print(f"âœ… å·²å‘é€æé†’ï¼š{pokemon_name}")
    except Exception as e:
        print("âŒ æ¨é€å¤±è´¥:", e)


def extract_first_png_filename(driver):
    """æå–ç¬¬ä¸€ä¸ª .png å›¾ç‰‡çš„æ–‡ä»¶å"""
    try:
        images = driver.find_elements("tag name", "img")
        for img in images:
            src = img.get_attribute("src")
            if src and ".png" in src.lower():
                filename = src.split('/')[-1].split('?')[0]
                return filename
    except Exception as e:
        print("âš ï¸ æå–å›¾ç‰‡å¤±è´¥:", e)
    return None


def extract_top_three_numbers(driver):
    """æå–å‰ä¸‰ä¸ª .png æ–‡ä»¶åä¸­çš„æ•°å­—"""
    numbers = []
    try:
        time.sleep(6)
        images = driver.find_elements("tag name", "img")
        for img in images:
            src = img.get_attribute("src")
            if not src or ".png" not in src.lower():
                continue
            filename = src.split('/')[-1].split('?')[0].strip()
            match = re.search(r'(\d+)', filename)
            if match:
                num = int(match.group(1))
                numbers.append(num)
                if len(numbers) >= 3:
                    break
    except Exception as e:
        print("âš ï¸ æå–å‰ä¸‰æ•°å­—å¤±è´¥:", e)

    while len(numbers) < 3:
        numbers.append(0)
    return numbers[:3]


def is_valid_number(n):
    """æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆç¼–å·ï¼š100~64900 ä¸”æ•´é™¤100"""
    return 100 <= n <= 64900 and n % 100 == 0


def all_valid(numbers):
    """æ£€æŸ¥ä¸‰ä¸ªæ•°å­—æ˜¯å¦éƒ½æœ‰æ•ˆ"""
    return all(is_valid_number(n) for n in numbers)


def get_pokedex_id_from_filename(filename):
    """ä»æ–‡ä»¶åæå–å›¾é‰´ç¼–å·"""
    match = re.search(r'(\d+)', filename)
    if match:
        num = int(match.group(1))
        return num // 100
    return None


def get_pokemon_name(pokedex_id):
    """æŸ¥è¯¢å®å¯æ¢¦ä¸­æ–‡å"""
    return POKEMON_ZH.get(pokedex_id, f"æœªçŸ¥å®å¯æ¢¦ #{pokedex_id}")


def load_last_numbers():
    """åŠ è½½ä¸Šæ¬¡è®°å½•çš„ä¸‰ä¸ªæ•°å­—"""
    if os.path.exists(DATA_FILE):
        try:
            with open(DATA_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
                nums = data.get("numbers", [0, 0, 0])
                print(f"âœ… æˆåŠŸåŠ è½½å†å²æ•°ç»„: {nums}")
                return nums
        except (json.JSONDecodeError, OSError) as e:
            print(f"âš ï¸ è¯»å– {DATA_FILE} å¤±è´¥: {e} â†’ ä½¿ç”¨é»˜è®¤å€¼ [0,0,0]")
    else:
        print(f"ğŸ” {DATA_FILE} ä¸å­˜åœ¨ â†’ é¦–æ¬¡è¿è¡Œï¼Œä½¿ç”¨é»˜è®¤å€¼ [0,0,0]")
    return [0, 0, 0]


def save_current_numbers(nums):
    """ä¿å­˜å½“å‰ä¸‰ä¸ªæ•°å­—"""
    try:
        # ç¡®ä¿ç›®å½•å­˜åœ¨
        os.makedirs(os.path.dirname(DATA_FILE) if os.path.dirname(DATA_FILE) else '.', exist_ok=True)
        with open(DATA_FILE, 'w', encoding='utf-8') as f:
            json.dump({"numbers": nums}, f, ensure_ascii=False, indent=2)
        print(f"ğŸ’¾ å·²ä¿å­˜å½“å‰æ•°ç»„: {nums}")
    except Exception as e:
        print(f"âŒ ä¿å­˜å¤±è´¥ {DATA_FILE}: {e}")


# ä¸»é€»è¾‘
if __name__ == "__main__":
    driver = None
    try:
        print(f"[{datetime.now()}] æ­£åœ¨æ£€æŸ¥å¤´ç›®æ›´æ–°...")
        driver = get_driver()
        driver.get(URL)

        # æå–å½“å‰å‰ä¸‰å¼ å›¾çš„æ•°å­—
        current_numbers = extract_top_three_numbers(driver)
        print(f"ğŸ“Š å½“å‰å‰ä¸‰æ•°å­—: {current_numbers}")

        # æ¡ä»¶1ï¼šå¿…é¡»å…¨éƒ¨åˆæ³•
        if not all_valid(current_numbers):
            print("ğŸš« å­˜åœ¨æ— æ•ˆæ•°å­—ï¼Œè·³è¿‡æé†’")
            exit(0)

        # åŠ è½½ä¸Šæ¬¡çŠ¶æ€
        last_numbers = load_last_numbers()

        # æ¡ä»¶2ï¼šå¿…é¡»å‘ç”Ÿå˜åŒ–
        if current_numbers == last_numbers:
            print("âœ… æ•°ç»„æ— å˜åŒ–ï¼Œè·³è¿‡")
            exit(0)

        # --- æ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼šæœ‰æ•ˆ + ä¸åŒ ---
        print(f"ğŸ”” æ£€æµ‹åˆ°çœŸå®æ›´æ–°ï¼š{last_numbers} â†’ {current_numbers}")

        # è·å–ç¬¬ä¸€ä¸ªå›¾ç‰‡å¯¹åº”çš„å®å¯æ¢¦åç§°
        filename = extract_first_png_filename(driver)
        if not filename:
            pokemon_name = "æ–°å¤´ç›®ç™»åœº"
        else:
            pokedex_id = get_pokedex_id_from_filename(filename)
            if pokedex_id:
                pokemon_name = get_pokemon_name(pokedex_id)
            else:
                pokemon_name = "æ–°å¤´ç›®ç™»åœº"

        print(f"ğŸ¯ å°†æ˜¾ç¤ºï¼š{pokemon_name}")

        # å‘é€æé†’
        send_alert(pokemon_name)

        # ä¿å­˜æœ¬æ¬¡çŠ¶æ€
        save_current_numbers(current_numbers)

    except Exception as e:
        print("âŒ é”™è¯¯:", str(e))
    finally:
        if driver:
            driver.quit()
