# detect.py - ä»…å½“ç¬¬ä¸€ä¸ªå›¾ç‰‡å˜åŒ–ä¸”ä¸æ˜¯ alpha.png æ—¶æé†’
import os
import time
import json
import re
from datetime import datetime
import requests
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager

# === æ’å…¥å›¾é‰´ï¼ˆPOKEMON_ZH å­—å…¸ï¼‰===
# #æ’å…¥å›¾é‰´
POKEMON_ZH = {
    # ç¬¬ä¸€ä¸–ä»£ (1-151)
    1: "å¦™è›™ç§å­", 2: "å¦™è›™è‰", 3: "å¦™è›™èŠ±",
    4: "å°ç«é¾™", 5: "ç«æé¾™", 6: "å–·ç«é¾™",
    7: "æ°å°¼é¾Ÿ", 8: "å¡å’ªé¾Ÿ", 9: "æ°´ç®­é¾Ÿ",
    10: "ç»¿æ¯›è™«", 11: "é“ç”²è›¹", 12: "å·´å¤§è¶",
    13: "ç‹¬è§’è™«", 14: "é“å£³è›¹", 15: "å¤§é’ˆèœ‚",
    16: "æ³¢æ³¢", 17: "æ¯”æ¯”é¸Ÿ", 18: "å¤§æ¯”é¸Ÿ",
    19: "å°æ‹‰è¾¾", 20: "æ‹‰è¾¾",
    21: "çƒˆé›€", 22: "å¤§å˜´é›€",
    23: "é˜¿æŸè›‡", 24: "é˜¿æŸæ€ª",
    25: "çš®å¡ä¸˜", 26: "é›·ä¸˜",
    27: "ç©¿å±±é¼ ", 28: "ç©¿å±±ç‹",
    29: "å°¼å¤šå…°", 30: "å°¼å¤šå¨œ", 31: "å°¼å¤šå", 32: "å°¼å¤šåŠ›è¯º", 33: "å°¼å¤šæœ—", 34: "å°¼å¤šç‹",
    35: "çš®çš®", 36: "çš®å¯è¥¿",
    37: "å…­å°¾", 38: "ä¹å°¾",
    39: "èƒ–ä¸", 40: "èƒ–å¯ä¸",
    41: "è¶…éŸ³è ", 42: "å¤§å˜´è ",
    43: "èµ°è·¯è‰", 44: "è‡­è‡­èŠ±", 45: "éœ¸ç‹èŠ±",
    46: "æ´¾æ‹‰æ–¯", 47: "æ´¾æ‹‰æ–¯ç‰¹",
    48: "æ¯›çƒ", 49: "æœ«å…¥è›¾",
    50: "åœ°é¼ ", 51: "ä¸‰åœ°é¼ ",
    52: "å–µå–µ", 53: "çŒ«è€å¤§",
    54: "å¯è¾¾é¸­", 55: "å“¥è¾¾é¸­",
    56: "çŒ´æ€ª", 57: "ç«çˆ†çŒ´",
    58: "å¡è’‚ç‹—", 59: "é£é€Ÿç‹—",
    60: "èšŠé¦™èŒèšª", 61: "èšŠé¦™è›™", 62: "å¿«æ³³è›™",
    63: "å‡¯è¥¿", 64: "å‹‡åŸºæ‹‰", 65: "èƒ¡åœ°",
    66: "è…•åŠ›", 67: "è±ªåŠ›", 68: "æ€ªåŠ›",
    69: "å–‡å­èŠ½", 70: "å£å‘†èŠ±",71: "å¤§é£ŸèŠ±",
    72: "ç›ç‘™æ°´æ¯", 73: "æ¯’åˆºæ°´æ¯",
    74: "å°æ‹³çŸ³", 75: "éš†éš†çŸ³", 76: "éš†éš†å²©",
    77: "å°ç«é©¬", 78: "çƒˆç„°é©¬",
    79: "å‘†å‘†å…½", 80: "å‘†æ²³é©¬",
    81: "å°ç£æ€ª", 82: "ä¸‰åˆä¸€ç£æ€ª",
    83: "å¤§è‘±é¸­", 84: "å˜Ÿå˜Ÿ", 85: "å˜Ÿå˜Ÿåˆ©",
    86: "å°æµ·ç‹®", 87: "ç™½æµ·ç‹®",
    88: "è‡­æ³¥", 89: "è‡­è‡­æ³¥",
    90: "å¤§èˆŒè´", 91: "åˆºç”²è´",
    92: "é¬¼æ–¯", 93: "é¬¼æ–¯é€š", 94: "è€¿é¬¼",
    95: "å¤§å²©è›‡",
    96: "å‚¬çœ è²˜", 97: "å¼•æ¢¦è²˜äºº",
    98: "å¤§é’³èŸ¹", 99: "å·¨é’³èŸ¹",
    100: "éœ¹é›³ç”µçƒ", 101: "é¡½çš®é›·å¼¹",
    102: "è›‹è›‹", 103: "æ¤°è›‹æ ‘",
    104: "å¡æ‹‰å¡æ‹‰", 105: "å˜å•¦å˜å•¦",
    106: "é£è…¿éƒ", 107: "å¿«æ‹³éƒ",
    108: "å¤§èˆŒå¤´",
    109: "ç“¦æ–¯å¼¹", 110: "åŒå¼¹ç“¦æ–¯",
    111: "ç‹¬è§’çŠ€ç‰›", 112: "é’»è§’çŠ€å…½",
    113: "å‰åˆ©è›‹",
    114: "è”“è—¤æ€ª",
    115: "è¢‹å…½",
    116: "å¢¨æµ·é©¬", 117: "æµ·åˆºé¾™",
    118: "è§’é‡‘é±¼", 119: "é‡‘é±¼ç‹", 
    120: "æµ·æ˜Ÿæ˜Ÿ",121: "å®çŸ³æµ·æ˜Ÿ",
    122: "é­”å¢™äººå¶",
    123: "é£å¤©è³è‚",
    124: "è¿·å”‡å§",
    125: "ç”µå‡»å…½",
    126: "é¸­å˜´ç«å…½",
    127: "å‡¯ç½—æ–¯",
    128: "è‚¯æ³°ç½—",
    129: "é²¤é±¼ç‹", 130: "æš´é²¤é¾™",
    131: "ä¹˜é¾™",
    132: "ç™¾å˜æ€ª",
    133: "ä¼Šå¸ƒ", 134: "æ°´ä¼Šå¸ƒ", 135: "é›·ä¼Šå¸ƒ", 136: "ç«ä¼Šå¸ƒ",
    137: "å¤šè¾¹å…½",
    138: "èŠçŸ³å…½", 139: "å¤šåˆºèŠçŸ³å…½",
    140: "åŒ–çŸ³ç›”", 141: "é•°åˆ€ç›”",
    142: "åŒ–çŸ³ç¿¼é¾™",
    143: "å¡æ¯”å…½",
    144: "æ€¥å†»é¸Ÿ",
    145: "é—ªç”µé¸Ÿ",
    146: "ç«ç„°é¸Ÿ",
    147: "è¿·ä½ é¾™", 148: "å“ˆå…‹é¾™", 149: "å¿«é¾™",
    150: "è¶…æ¢¦", 151: "æ¢¦å¹»",

    # ç¬¬äºŒä¸–ä»£ (152-251)
    152: "èŠè‰å¶", 153: "æœˆæ¡‚å¶", 154: "å¤§èŠèŠ±",
    155: "ç«çƒé¼ ", 156: "ç«å²©é¼ ", 157: "ç«æš´å…½",
    158: "å°é”¯é³„", 159: "è“é³„", 160: "å¤§åŠ›é³„",
    161: "å°¾ç«‹", 162: "å¤§å°¾ç«‹",
    163: "å’•å’•", 164: "çŒ«å¤´å¤œé¹°",
    165: "èŠ­ç“¢è™«", 166: "å®‰ç“¢è™«",
    167: "å›­ä¸è››", 168: "é˜¿åˆ©å¤šæ–¯",
    169: "å‰å­—è ",
    170: "ç¯ç¬¼é±¼", 171: "ç”µç¯æ€ª",
    172: "çš®ä¸˜",
    173: "çš®å®å®",
    174: "å®å®ä¸",
    175: "æ³¢å…‹æ¯”", 176: "æ³¢å…‹åŸºå¤",
    177: "å¤©ç„¶é›€", 178: "å¤©ç„¶é¸Ÿ",
    179: "å’©åˆ©ç¾Š", 180: "èŒ¸èŒ¸ç¾Š", 181: "ç”µé¾™",
    182: "ç¾ä¸½èŠ±",
    183: "ç›åŠ›éœ²", 184: "ç›åŠ›éœ²ä¸½",
    185: "æ ‘æ‰æ€ª",
    186: "èšŠé¦™è›™çš‡",
    187: "æ¯½å­è‰", 188: "æ¯½å­èŠ±", 189: "æ¯½å­æ£‰",
    190: "é•¿å°¾æ€ªæ‰‹",
    191: "å‘æ—¥ç§å­", 192: "å‘æ—¥èŠ±æ€ª",
    193: "èœ»èœ»èœ“", 
    194: "ä¹Œæ³¢", 195: "æ²¼ç‹",
    196: "å¤ªé˜³ä¼Šå¸ƒ", 197: "æœˆäº®ä¼Šå¸ƒ",
    198: "é»‘æš—é¸¦",
    199: "å‘†å‘†ç‹",
    200: "æ¢¦å¦–",
    201: "æœªçŸ¥å›¾è…¾",
    202: "æœç„¶ç¿",
    203: "éº’éºŸå¥‡",
    204: "æ¦›æœçƒ",205: "ä½›çƒˆæ‰˜æ–¯",
    206: "åœŸé¾™å¼Ÿå¼Ÿ",
    207: "å¤©è",
    208: "å¤§é’¢è›‡",
    209: "å¸ƒé²", 210: "å¸ƒé²çš‡", 
    211: "åƒé’ˆé±¼",
    212: "å·¨é’³è³è‚", 
    213: "å£¶å£¶",
    214: "èµ«æ‹‰å…‹ç½—æ–¯",
    215: "ç‹ƒæ‹‰", 
    216: "ç†Šå®å®",217: "åœˆåœˆç†Š", 
    218: "ç†”å²©è™«", 219: "ç†”å²©èœ—ç‰›",
    220: "å°å±±çŒª", 221: "é•¿æ¯›çŒª",
    222: "å¤ªé˜³çŠç‘š",
    223: "é“ç‚®é±¼", 224: "ç« é±¼æ¡¶",
    225: "ä¿¡ä½¿é¸Ÿ",
    226: "å·¨ç¿…é£é±¼",
    227: "ç›”ç”²é¸Ÿ",
    228: "æˆ´é²æ¯”",229: "é»‘é²åŠ ",
    230: "åˆºé¾™ç‹",
    231: "å°å°è±¡", 232: "é¡¿ç”²",
    233: "å¤šè¾¹å…½â…¡",
    234: "æƒŠè§’é¹¿",
    235: "å›¾å›¾çŠ¬",
    236: "æ— ç•å°å­", 237: "æˆ˜èˆéƒ",
    238: "è¿·å”‡å¨ƒ",
    239: "ç”µå‡»æ€ª", 240: "é¸­å˜´å®å®",
    241: "å¤§å¥¶ç½",
    242: "å¹¸ç¦è›‹",
    243: "é›·å…¬",
    244: "ç‚å¸",
    245: "æ°´å›",
    246: "å¹¼åŸºæ‹‰æ–¯", 247: "æ²™åŸºæ‹‰æ–¯", 248: "ç­åŸºæ‹‰æ–¯",
    249: "æ´›å¥‡äºš",
    250: "å‡¤ç‹",
    251: "æ—¶æ‹‰æ¯”",

    # ç¬¬ä¸‰ä¸–ä»£ (252-386)
    252: "æœ¨å®ˆå®«", 253: "æ£®æ—èœ¥èœ´", 254: "èœ¥èœ´ç‹",
    255: "ç«ç¨šé¸¡", 256: "åŠ›å£®é¸¡", 257: "ç«ç„°é¸¡",
    258: "æ°´è·ƒé±¼", 259: "æ²¼è·ƒé±¼", 260: "å·¨æ²¼æ€ª",
    261: "åœŸç‹¼çŠ¬", 262: "å¤§ç‹¼çŠ¬",
    263: "è›‡çº¹ç†Š", 264: "ç›´å†²ç†Š",
    265: "åˆºå°¾è™«", 266: "ç”²å£³èŒ§", 267: "ç‹©çŒå‡¤è¶",
    268: "ç›¾ç”²èŒ§", 269: "æ¯’ç²‰è›¾",
    270: "è²å¶ç«¥å­", 271: "è²å¸½å°ç«¥", 272: "ä¹å¤©æ²³ç«¥",
    273: "æ©¡å®æœ", 274: "é•¿é¼»å¶", 275: "ç‹¡çŒ¾å¤©ç‹—",
    276: "å‚²éª¨ç‡•", 277: "å¤§ç‹ç‡•",
    278: "é•¿ç¿…é¸¥", 279: "å¤§å˜´é¸¥",
    280: "æ‹‰é²æ‹‰ä¸", 281: "å¥‡é²è‰å®‰", 282: "æ²™å¥ˆæœµ",
    283: "æºœæºœç³–çƒ", 284: "é›¨ç¿…è›¾",
    285: "è˜‘è˜‘è‡", 286: "æ–—ç¬ è‡",
    287: "æ‡’äººç¿", 288: "è¿‡åŠ¨çŒ¿", 289: "è¯·å‡ç‹",
    290: "åœŸå±…å¿å£«", 291: "é“é¢å¿è€…",292: "è„±å£³å¿è€…",
    293: "å’•å¦å¦",294: "å¼çˆ†å¼¹",295: "çˆ†éŸ³æ€ª", 
    296: "å¹•ä¸‹åŠ›å£«",297: "é“æŒåŠ›å£«", 
    298: "éœ²åŠ›ä¸½",
    299: "æœåŒ—é¼»", 
    300: "å‘å°¾å–µ", 301: "ä¼˜é›…çŒ«",
    302: "å‹¾é­‚çœ¼", 
    303: "å¤§å˜´å¨ƒ",
    304: "å¯å¯å¤šæ‹‰", 305: "å¯å¤šæ‹‰", 306: "æ³¢å£«å¯å¤šæ‹‰",
    307: "ç›æ²™é‚£", 308: "æ°é›·å§†", 
    309: "è½é›·å…½",310: "é›·ç”µå…½",
    311: "æ­£ç”µæ‹æ‹",312: "è´Ÿç”µæ‹æ‹", 
    313: "ç”µè¤è™«",314: "ç”œç”œè¤", 
    315: "æ¯’è”·è–‡", 
    316: "æº¶é£Ÿå…½",317: "åé£Ÿå…½", 
    318: "åˆ©ç‰™é±¼",319: "å·¨ç‰™é²¨", 
    320: "å¼å¼é²¸", 321: "å¼é²¸ç‹",
    322: "å‘†ç«é©¼", 323: "å–·ç«é©¼",
    324: "ç…¤ç‚­é¾Ÿ",
    325: "è·³è·³çŒª", 326: "å™—å™—çŒª",
    327: "æ™ƒæ™ƒæ–‘",
    328: "å¤§é¢šèš", 329: "è¶…éŸ³æ³¢å¹¼è™«", 330: "æ²™æ¼ èœ»èœ“",
    331: "åˆºçƒä»™äººæŒ", 332: "æ¢¦æ­Œä»™äººæŒ", 
    333: "é’æ£‰é¸Ÿ",334: "ä¸ƒå¤•é’é¸Ÿ", 
    335: "çŒ«é¼¬æ–©",
    336: "é¥­åŒ™è›‡",
    337: "æœˆçŸ³", 338: "å¤ªé˜³å²©",
    339: "æ³¥æ³¥é³…", 340: "é²¶é±¼ç‹",
    341: "é¾™è™¾å°å…µ", 342: "é“é³Œé¾™è™¾",
    343: "å¤©å¹³å¶", 344: "å¿µåŠ›åœŸå¶",
    345: "è§¦æ‰‹ç™¾åˆ",346: "æ‘‡ç¯®ç™¾åˆ", 
    347: "å¤ªå¤ç¾½è™«",348: "å¤ªå¤ç›”ç”²",
    349: "ä¸‘ä¸‘é±¼",350: "ç¾çº³æ–¯", 
    351: "æ¼‚æµ®æ³¡æ³¡",
    352: "å˜éšé¾™",
    353: "æ€¨å½±å¨ƒå¨ƒ", 354: "è¯…å’’å¨ƒå¨ƒ", 
    355: "å¤œå·¡çµ",356: "å½·å¾¨å¤œçµ", 
    357: "çƒ­å¸¦é¾™",
    358: "é£é“ƒé“ƒ",
    359: "é˜¿ä¼¯æ¢­é²",
    360: "å°æœç„¶", 
    361: "é›ªç«¥å­",362: "å†°é¬¼æŠ¤", 
    363: "æµ·è±¹çƒ",364: "æµ·é­”ç‹®", 365: "å¸ç‰™æµ·ç‹®",
    366: "çç è´",367: "çŒæ–‘é±¼", 368: "æ¨±èŠ±é±¼", 
    369: "å¤ç©ºæ£˜é±¼",
    370: "çˆ±å¿ƒé±¼",
    371: "å®è´é¾™",372: "ç”²å£³é¾™",373: "æš´é£é¾™", 
    374: "é“å“‘é“ƒ",375: "é‡‘å±æ€ª", 376: "å·¨é‡‘æ€ª",
    377: "é›·å‰æ´›å…‹", 
    378: "é›·å‰è‰¾æ–¯",
    379: "é›·å‰æ–¯é½é²", 
    380: "æ‹‰å¸äºšæ–¯", 
    381: "æ‹‰å¸æ¬§æ–¯",
    382: "ç›–æ¬§å¡",
    383: "å›ºæ‹‰å¤š",
    384: "è£‚ç©ºåº§",
    385: "åŸºæ‹‰ç¥ˆ",
    386: "ä»£æ¬§å¥‡å¸Œæ–¯",

    # ç¬¬å››ä¸–ä»£ (387-493)
    387: "è‰è‹—é¾Ÿ", 388: "æ ‘æ—é¾Ÿ", 389: "åœŸå°é¾Ÿ",
    390: "å°ç«ç„°çŒ´", 391: "çŒ›ç«çŒ´", 392: "çƒˆç„°çŒ´",
    393: "æ³¢åŠ æ›¼", 394: "æ³¢çš‡å­", 395: "å¸ç‹æ‹¿æ³¢",
    396: "å§†å…‹å„¿", 397: "å§†å…‹é¸Ÿ", 398: "å§†å…‹é¹°",
    399: "å¤§ç‰™ç‹¸", 400: "å¤§å°¾ç‹¸",
    401: "åœ†æ³•å¸ˆ", 402: "éŸ³ç®±èŸ€", 
    403: "å°çŒ«æ€ª",404: "å‹’å…‹çŒ«", 405: "ä¼¦ç´çŒ«",
    406: "å«ç¾è‹", 407: "ç½—ä¸é›·æœµ",
    408: "å¤´ç›–é¾™", 409: "æˆ˜æ§Œé¾™",
    410: "ç›¾ç”²é¾™", 411: "æŠ¤åŸé¾™", 
    412: "ç»“è‰å„¿",413: "ç»“è‰è´µå¦‡", 414: "ç»…å£«è›¾",
    415: "ä¸‰èœœèœ‚", 416: "èœ‚å¥³ç‹",
    417: "å¸•å¥‡åˆ©å…¹",
    418: "æ³³åœˆé¼¬", 419: "æµ®æ½œé¼¬", 
    420: "æ¨±èŠ±å®", 421: "æ¨±èŠ±å„¿", 
    422: "æ— å£³æµ·å…”", 423: "æµ·å…”å…½", 
    424: "åŒå°¾æ€ªæ‰‹",
    425: "é£˜é£˜çƒ", 426: "éšé£çƒ",
    427: "å·å·è€³", 428: "é•¿è€³å…”",
    429: "æ¢¦å¦–é­”",
    430: "ä¹Œé¸¦å¤´å¤´",
    431: "é­…åŠ›å–µ", 432: "ä¸œæ–½å–µ",
    433: "é“ƒé“›å“", 
    434: "è‡­é¼¬å™—",435: "å¦å…‹è‡­é¼¬",
    436: "é“œé•œæ€ª",437: "é’é“œé’Ÿ", 
    438: "ç›†æ‰æ€ª",
    439: "é­”å°¼å°¼", 
    440: "å°ç¦è›‹",
    441: "è’å™ªé¸Ÿ",
    442: "èŠ±å²©æ€ª",
    443: "åœ†é™†é²¨",444: "å°–ç‰™é™†é²¨",445: "çƒˆå’¬é™†é²¨", 
    446: "å°å¡æ¯”å…½",
    447: "åˆ©æ¬§è·¯", 448: "è·¯å¡åˆ©æ¬§", 
    449: "æ²™æ²³é©¬",450: "æ²³é©¬å…½",
    451: "é’³å°¾è",452: "é¾™ç‹è", 
    453: "ä¸è‰¯è›™", 454: "æ¯’éª·è›™",
    455: "å°–ç‰™ç¬¼",
    456: "è§å…‰é±¼", 457: "éœ“è™¹é±¼",
    458: "å°çƒé£é±¼", 
    459: "é›ªç¬ æ€ª",460: "æš´é›ªç‹",
    461: "ç›ç‹ƒæ‹‰",
    462: "è‡ªçˆ†ç£æ€ª",
    463: "å¤§èˆŒèˆ”", 
    464: "è¶…ç”²ç‹‚çŠ€",
    465: "å·¨è”“è—¤", 
    466: "ç”µå‡»é­”å…½",
    467: "é¸­å˜´ç‚å…½", 
    468: "æ³¢å…‹åŸºæ–¯", 
    469: "è¿œå¤å·¨èœ“",
    470: "å¶ä¼Šå¸ƒ",
    471: "å†°ä¼Šå¸ƒ",
    472: "å¤©èç‹", 
    473: "è±¡ç‰™çŒª",
    474: "å¤šè¾¹å…½ä¹™å‹",
    475: "è‰¾è·¯é›·æœµ",
    476: "å¤§æœåŒ—é¼»", 
    477: "é»‘å¤œé­”çµ",
    478: "é›ªå¦–å¥³", 
    479: "æ´›æ‰˜å§†",
    480: "ç”±å…‹å¸Œ",481: "è‰¾å§†åˆ©å¤š", 482: "äºšå…‹è¯ºå§†",
    483: "å¸ç‰™å¢å¡", 484: "å¸•è·¯å¥‡äºš",
    485: "å¸­å¤šè“æ©",
    486: "é›·å‰å¥‡å¡æ–¯", 
    487: "éª‘æ‹‰å¸çº³",
    488: "å…‹é›·è‰²åˆ©äºš", 
    489: "éœæ¬§çº³", 490: "ç›çº³éœ",
    491: "è¾¾å…‹è±ä¼Š",
    492: "è°¢ç±³", 
    493: "é˜¿å°”å®™æ–¯",

    # ç¬¬äº”ä¸–ä»£ (494-649)
    494: "æ¯”å…‹æå°¼",  
    495: "è—¤è—¤è›‡", 496: "é’è—¤è›‡", 497: "å›ä¸»è›‡",     
    498: "æš–æš–çŒª", 499: "ç‚’ç‚’çŒª", 500: "ç‚æ­¦ç‹",    
    501: "æ°´æ°´ç­", 502: "åŒåˆƒä¸¸", 503: "å¤§å‰‘é¬¼",
    504: "æ¢æ¢é¼ ", 505: "æ­¥å“¨é¼ ",
    506: "å°çº¦å…‹", 507: "å“ˆçº¦å…‹", 508: "é•¿æ¯›ç‹—",
    509: "æ‰’æ‰‹çŒ«", 510: "é…·è±¹",    
    511: "èŠ±æ¤°çŒ´", 512: "èŠ±æ¤°çŒ¿",    
    513: "çˆ†é¦™çŒ´", 514: "çˆ†é¦™çŒ¿",
    515: "å†·æ°´çŒ´", 516: "å†·æ°´çŒ¿",     
    517: "é£Ÿæ¢¦æ¢¦", 518: "æ¢¦æ¢¦èš€",  
    519: "è±†è±†é¸½", 520: "å’•å’•é¸½", 521: "é«˜å‚²é›‰é¸¡",   
    522: "æ–‘æ–‘é©¬", 523: "é›·ç”µæ–‘é©¬",
    524: "çŸ³ä¸¸å­", 525: "åœ°å¹”å²©", 526: "åºå²©æ€ª",
    527: "æ»šæ»šè™è ", 528: "å¿ƒè™è ",   
    529: "èºé’‰åœ°é¼ ", 530: "é¾™å¤´åœ°é¼ ",  
    531: "å·®ä¸å¤šå¨ƒå¨ƒ",   
    532: "æ¬è¿å°åŒ ", 533: "é“éª¨åœŸäºº", 534: "ä¿®å»ºè€åŒ ",  
    535: "åœ†èŒèšª", 536: "è“èŸ¾èœ", 537: "èŸ¾èœç‹", 
    538: "æŠ•æ‘”é¬¼", 539: "æ‰“å‡»é¬¼",   
    540: "è™«å®åŒ…", 541: "å®åŒ…èŒ§", 542: "ä¿å§†è™«",  
    543: "ç™¾è¶³èœˆèš£", 544: "è½¦è½®çƒ", 545: "èœˆèš£ç‹",    
    546: "æœ¨æ£‰çƒ", 547: "é£å¦–ç²¾",
    548: "ç™¾åˆæ ¹å¨ƒå¨ƒ", 549: "è£™å„¿å°å§",   
    550: "é‡è›®é²ˆé±¼",
    551: "é»‘çœ¼é³„", 552: "æ··æ··é³„", 553: "æµæ°“é³„",
    554: "ç«çº¢ä¸å€’ç¿", 555: "è¾¾æ‘©ç‹’ç‹’",   
    556: "æ²™é“ƒä»™äººæŒ",
    557: "çŸ³å±…èŸ¹", 558: "å²©æ®¿å±…èŸ¹",  
    559: "æ»‘æ»‘å°å­", 560: "å¤´å·¾æ··æ··",  
    561: "è±¡å¾é¸Ÿ",  
    562: "å“­å“­é¢å…·", 563: "è¿­å¤±æ£º",
    564: "åŸç›–æµ·é¾Ÿ", 565: "è‚‹éª¨æµ·é¾Ÿ",
    566: "å§‹ç¥–å°é¸Ÿ", 567: "å§‹ç¥–å¤§é¸Ÿ",   
    568: "ç ´ç ´è¢‹", 569: "ç°å°˜å±±",  
    570: "ç´¢ç½—äºš", 571: "ç´¢ç½—äºšå…‹",
    572: "æ³¡æ²«æ —é¼ ", 573: "å¥‡è¯ºæ —é¼ ",  
    574: "å“¥å¾·å®å®", 575: "å“¥å¾·å°ç«¥", 576: "å“¥å¾·å°å§",   
    577: "å•åµç»†èƒçƒ", 578: "åŒåµç»†èƒçƒ", 579: "äººé€ ç»†èƒåµ", 
    580: "é¸­å®å®", 581: "èˆå¤©é¹…",   
    582: "è¿·ä½ å†°", 583: "å¤šå¤šå†°", 584: "åŒå€å¤šå¤šå†°",  
    585: "å››å­£é¹¿", 586: "èŒèŠ½é¹¿",
    587: "ç”µé£é¼ ",  
    588: "ç›–ç›–è™«", 589: "éª‘å£«èœ—ç‰›",
    590: "å“å‘€çƒè‡", 591: "è´¥éœ²çƒè‡",  
    592: "è½»é£˜é£˜", 593: "èƒ–å˜Ÿå˜Ÿ",     
    594: "ä¿å§†æ›¼æ³¢",   
    595: "ç”µç”µè™«", 596: "ç”µèœ˜è››", 
    597: "ç§å­é“çƒ", 598: "åšæœå“‘é“ƒ",
    599: "é½¿è½®å„¿", 600: "é½¿è½®ç»„", 601: "é½¿è½®æ€ª",
    602: "éº»éº»å°é±¼", 603: "éº»éº»é³—", 604: "éº»éº»é³—é±¼ç‹	",
    605: "å°ç°æ€ª",  606: "å¤§å®‡æ€ª",   
    607: "çƒ›å…‰çµ", 608: "ç¯ç«å¹½çµ", 609: "æ°´æ™¶ç¯ç«çµ",  
    610: "ç‰™ç‰™",  611: "æ–§ç‰™é¾™", 612: "åŒæ–§æˆ˜é¾™",   
    613: "å–·åšç†Š", 614: "å†»åŸç†Š",   
    615: "å‡ ä½•é›ªèŠ±",  
    616: "å°å˜´èœ—", 617: "æ•æ·è™«",   
    618: "æ³¥å·´é±¼",  
    619: "åŠŸå¤«é¼¬", 620: "å¸ˆçˆ¶é¼¬",  
    621: "èµ¤é¢é¾™",  
    622: "æ³¥å¶å°äºº", 623: "æ³¥å¶å·¨äºº",   
    624: "é©¹åˆ€å°å…µ", 625: "åŠˆæ–©å¸ä»¤",
    626: "çˆ†ç‚¸å¤´æ°´ç‰›", 
    627: "æ¯›å¤´å°é¹°", 628: "å‹‡å£«é›„é¹°",
    629: "ç§ƒé¹°ä¸«å¤´", 630: "ç§ƒé¹°å¨œ", 
    631: "ç†”èšå…½",
    632: "é“èš",  
    633: "å•é¦–é¾™", 634: "åŒé¦–æš´é¾™", 635: " ä¸‰é¦–æ¶é¾™", 
    636: "ç‡ƒçƒ§è™«", 637: "ç«ç¥è›¾",
    638: "å‹¾å¸•è·¯ç¿", 639: "ä»£æ‹‰åŸºç¿", 640: "æ¯•åŠ›å‰ç¿",
    641: "é¾™å·äº‘",   
    642: "é›·ç”µäº‘", 
    643: "è±å¸Œæ‹‰å§†",
    644: "æ·å…‹ç½—å§†",  
    645: "åœŸåœ°äº‘",   
    646: "é…‹é›·å§†",
    647: "å‡¯è·¯è¿ªæ¬§",  
    648: "ç¾æ´›è€¶å¡”",  
    649: "ç›–è¯ºèµ›å…‹ç‰¹"
}

# === é…ç½® ===
URL = "https://pokemmo.lanbizi.com/monster-alpha"
SENDKEY = os.getenv("SENDKEY")
DATA_FILE = "last_three_sum.json"  # çŠ¶æ€æ–‡ä»¶


def get_driver():
    options = Options()
    options.add_argument('--headless')
    options.add_argument('--no-sandbox')
    options.add_argument('--disable-dev-shm-usage')
    service = Service(ChromeDriverManager().install())
    return webdriver.Chrome(service=service, options=options)


def send_alert(pokemon_name):
    title = "ğŸ”¥ æœ‰æ–°çš„å¤´ç›®å‡ºç°äº†"
    content = f"æœ€æ–°å¤´ç›®ï¼š**{pokemon_name}**\n\nè¯·ç«‹å³å‰å¾€æŸ¥çœ‹ >>\nğŸ”— [ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…]({URL})"
    try:
        requests.post(
            f"https://sctapi.ftqq.com/{SENDKEY}.send",
            data={"title": title, "desp": content},
            timeout=10
        )
        print(f"âœ… å·²å‘é€æé†’ï¼š{pokemon_name}")
    except Exception as e:
        print("âŒ æ¨é€å¤±è´¥:", e)


def extract_first_png_filename(driver):
    try:
        images = driver.find_elements("tag name", "img")
        for img in images:
            src = img.get_attribute("src")
            if src and ".png" in src.lower():
                filename = src.split('/')[-1].split('?')[0]
                return filename
    except Exception as e:
        print("âš ï¸ æå–å›¾ç‰‡å¤±è´¥:", e)
    return None


def extract_top_three_numbers(driver):
    numbers = []
    try:
        time.sleep(6)
        images = driver.find_elements("tag name", "img")
        for img in images:
            src = img.get_attribute("src")
            if not src or ".png" not in src.lower():
                continue
            filename = src.split('/')[-1].split('?')[0].strip()
            match = re.search(r'(\d+)', filename)
            if match:
                num = int(match.group(1))
                numbers.append(num)
                if len(numbers) >= 3:
                    break
    except Exception as e:
        print("âš ï¸ æå–å‰ä¸‰æ•°å­—å¤±è´¥:", e)

    while len(numbers) < 3:
        numbers.append(0)
    return numbers[:3]


def is_valid_number(n):
    return 100 <= n <= 64900 and n % 100 == 0


def all_valid(numbers):
    return all(is_valid_number(n) for n in numbers)


def get_pokedex_id_from_filename(filename):
    match = re.search(r'(\d+)', filename)
    if match:
        num = int(match.group(1))
        return num // 100
    return None


def get_pokemon_name(pokedex_id):
    return POKEMON_ZH.get(pokedex_id, f"æœªçŸ¥å®å¯æ¢¦ #{pokedex_id}")


def load_last_numbers():
    if os.path.exists(DATA_FILE):
        try:
            with open(DATA_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
                nums = data.get("numbers", [0, 0, 0])
                print(f"âœ… æˆåŠŸåŠ è½½å†å²æ•°ç»„: {nums}")
                return nums
        except (json.JSONDecodeError, OSError) as e:
            print(f"âš ï¸ è¯»å–å¤±è´¥: {e} â†’ ä½¿ç”¨é»˜è®¤å€¼")
    else:
        print("ğŸ” æœªæ‰¾åˆ°çŠ¶æ€æ–‡ä»¶ â†’ é¦–æ¬¡è¿è¡Œ")
    return [0, 0, 0]


def save_current_numbers(nums):
    try:
        with open(DATA_FILE, 'w', encoding='utf-8') as f:
            json.dump({"numbers": nums}, f, ensure_ascii=False, indent=2)
        print(f"ğŸ’¾ å·²ä¿å­˜å½“å‰æ•°ç»„: {nums}")
    except Exception as e:
        print(f"âŒ ä¿å­˜å¤±è´¥: {e}")


# ä¸»é€»è¾‘
if __name__ == "__main__":
    driver = None
    try:
        print(f"[{datetime.now()}] æ­£åœ¨æ£€æŸ¥å¤´ç›®æ›´æ–°...")
        
        # å¼ºåˆ¶æ‹‰å–æœ€æ–°çŠ¶æ€ï¼ˆé˜²æ­¢æ—§ç¼“å­˜ï¼‰
        os.system('git pull origin main || echo "é¦–æ¬¡è¿è¡Œï¼Œæ— è¿œç¨‹çŠ¶æ€"')

        driver = get_driver()
        driver.get(URL)

        current_numbers = extract_top_three_numbers(driver)
        print(f"ğŸ“Š å½“å‰å‰ä¸‰æ•°å­—: {current_numbers}")

        if not all_valid(current_numbers):
            print("ğŸš« å­˜åœ¨æ— æ•ˆæ•°å­—ï¼Œè·³è¿‡æé†’")
            exit(0)

        last_numbers = load_last_numbers()

        if current_numbers == last_numbers:
            print("âœ… æ•°ç»„æ— å˜åŒ–ï¼Œè·³è¿‡")
            exit(0)

        print(f"ğŸ”” æ£€æµ‹åˆ°çœŸå®æ›´æ–°ï¼š{last_numbers} â†’ {current_numbers}")

        filename = extract_first_png_filename(driver)
        pokedex_id = get_pokedex_id_from_filename(filename) if filename else None
        pokemon_name = get_pokemon_name(pokedex_id) if pokedex_id else "æ–°å¤´ç›®ç™»åœº"

        print(f"ğŸ¯ å°†æ˜¾ç¤ºï¼š{pokemon_name}")
        send_alert(pokemon_name)

        save_current_numbers(current_numbers)

    except Exception as e:
        print("âŒ é”™è¯¯:", str(e))
    finally:
        if driver:
            driver.quit()
